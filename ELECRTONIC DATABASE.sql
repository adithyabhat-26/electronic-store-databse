create database ELECTRONIC_STORE
Use ELECTRONIC_STORE

CREATE TABLE SHOP (S_ID VARCHAR (20) PRIMARY KEY,  S_BRANCH VARCHAR (20), S_CONTACT VARCHAR(10) UNIQUE, S_MANAGER VARCHAR(20))

CREATE TABLE ELECTRONICS ( E_ID VARCHAR(20) PRIMARY KEY,TYPE VARCHAR (20), MODEL VARCHAR (20), AVAILABLE  CHAR(3), PRICE BIGINT,S_ID VARCHAR (20),
CONSTRAINT FK1 FOREIGN KEY(S_ID) REFERENCES  SHOP(S_ID),CHECK(AVAILABLE='Y' OR AVAILABLE='N'))

CREATE TABLE  CUSTOMER (C_ID VARCHAR (20) PRIMARY KEY,CUSTOMER_NAME VARCHAR (20), CUSTOMER_CONTACT VARCHAR(10), CUSTOMER_ADDRESS VARCHAR (20))

CREATE TABLE TRANSACTIONS(T_ID VARCHAR (20) PRIMARY KEY,T_DATE DATE,T_AMOUNT BIGINT,S_ID VARCHAR (20),
CONSTRAINT FK2 FOREIGN KEY(S_ID) REFERENCES SHOP(S_ID) ON DELETE SET NULL ON UPDATE CASCADE)

CREATE TABLE SOLD_TO(E_ID VARCHAR (20),C_ID VARCHAR (20) ,E_NAME VARCHAR(20), PRIMARY KEY(E_ID,C_ID),
CONSTRAINT FK3 FOREIGN KEY(E_ID) REFERENCES  ELECTRONICS(E_ID),  CONSTRAINT FK4 FOREIGN KEY(C_ID) REFERENCES  CUSTOMER(C_ID))

CREATE TABLE MAKE(T_ID VARCHAR (20),C_ID VARCHAR(20), PRIMARY KEY (T_ID,C_ID),
CONSTRAINT FK5 FOREIGN KEY(T_ID) REFERENCES  TRANSACTIONS(T_ID),  CONSTRAINT FK6 FOREIGN KEY(C_ID) REFERENCES  CUSTOMER(C_ID))

SP_HELP



INSERT INTO SHOP VALUES('S001','MANGALORE','9901239847','SHANMUKH')
INSERT INTO SHOP VALUES('S002','MYSORE','9976781235','GANESH')
INSERT INTO SHOP VALUES('S003','BANGALORE','9956778647','SHANTHI')
INSERT INTO SHOP VALUES('S004','DELHI','8676671247','SAKSHI')
INSERT INTO SHOP VALUES('S005','BIJAPUR','9478923456','VISHWESH')
INSERT INTO SHOP VALUES('S006','KOLAR','','SATHISH')



SELECT * FROM SHOP
SELECT * FROM ELECTRONICS   
ALTER TABLE ELECTRONICS DROP COLUMN TYPE

INSERT INTO ELECTRONICS VALUES('E001','M-026','Y',35000,'S002')
INSERT INTO ELECTRONICS VALUES('E002','M-039','Y',6000,'S003')
INSERT INTO ELECTRONICS VALUES('E003','M-056','N',25000,'S001')
INSERT INTO ELECTRONICS VALUES('E004','M-076','N',75000,'S005')
INSERT INTO ELECTRONICS VALUES('E005','M-077','Y',8000,'S004')
INSERT INTO ELECTRONICS VALUES('E006','M-056','Y',28000,'S002')
INSERT INTO ELECTRONICS VALUES('E007','M-056','Y',27000,'S003')
INSERT INTO ELECTRONICS VALUES('E008','M-078','Y',74000,'S006')
INSERT INTO ELECTRONICS VALUES('E009','M-079','N',75000,'S001')
INSERT INTO ELECTRONICS VALUES('E010','M-080','N',60000,'S002')
INSERT INTO ELECTRONICS VALUES('E011','M-081','Y',55000,'S001')


ALTER TABLE CUSTOMER ALTER COLUMN   CUSTOMER_CONTACT VARCHAR(10)


INSERT INTO CUSTOMER VALUES ('C001','SHUBHAM','9876543218','MANIPAL')
INSERT INTO CUSTOMER VALUES ('C002','JHANSI','9877671218','OOTY')
INSERT INTO CUSTOMER VALUES ('C003','SANGEETGA','8877563218','HUBLI')
INSERT INTO CUSTOMER VALUES ('C004','ABHIJEETH','9192435218','PANGLA')
INSERT INTO CUSTOMER VALUES ('C005','ARAVIND','8819876218','UDUPI')

SELECT *FROM CUSTOMER

INSERT INTO TRANSACTIONS VALUES ('TC12345','2021-12-06','6000','S003')
INSERT INTO TRANSACTIONS VALUES ('TC14122','2019-11-14','95000','S001')
INSERT INTO TRANSACTIONS VALUES ('TC34243','2012-12-26','23000','S001')
INSERT INTO TRANSACTIONS VALUES ('TC53217','2021-11-16','8000','S004')
INSERT INTO TRANSACTIONS VALUES ('TC23436','2021-09-6','75000','S005')
INSERT INTO TRANSACTIONS VALUES ('TC1346','2015-12-06','5000','S003')
INSERT INTO TRANSACTIONS VALUES ('TC12511','2010-05-14','55000','S002')
INSERT INTO TRANSACTIONS VALUES ('TC39575','2016-03-06','90000','S002')
INSERT INTO TRANSACTIONS VALUES ('TC23517','2011-06-12','62000','S002')
INSERT INTO TRANSACTIONS VALUES ('TC22136','2005-08-24','86000','S006')
INSERT INTO TRANSACTIONS VALUES ('TC11136','1998-04-24','32000','S002')

SELECT * FROM TRANSACTIONS

INSERT INTO SOLD_TO VALUES('E001','C001','GRINDER')
INSERT INTO SOLD_TO VALUES('E001','C002','GRINDER')
INSERT INTO SOLD_TO VALUES('E001','C003','GRINDER')
INSERT INTO SOLD_TO VALUES('E002','C004','MIXER')
INSERT INTO SOLD_TO VALUES('E002','C005','MIXER')
INSERT INTO SOLD_TO VALUES('E003','C001','WASHING MACHINE')
INSERT INTO SOLD_TO VALUES('E004','C001','MICROWAVE')
INSERT INTO SOLD_TO VALUES('E005','C001','FAN')
INSERT INTO SOLD_TO VALUES('E002','C003','TUBELIGHTS')
INSERT INTO SOLD_TO VALUES('E001','C004','AC')
INSERT INTO SOLD_TO VALUES('E005','C001','REFRIGERATOR')
INSERT INTO SOLD_TO VALUES('E003','C002','FAN')
INSERT INTO SOLD_TO VALUES('E001','C005','WASHING MACHINE')


SELECT * FROM SOLD_TO

INSERT INTO MAKE VALUES('TC12345','C001')
INSERT INTO MAKE VALUES('TC14521','C002')
INSERT INTO MAKE VALUES('TC34545','C003')
INSERT INTO MAKE VALUES('TC53217','C004')
INSERT INTO MAKE VALUES('TC23436','C005')
INSERT INTO MAKE VALUES('TC1346','C001')
INSERT INTO MAKE VALUES('TC22136','C001')

SELECT*FROM MAKE

sp_help


1) NAME THE CUSTOMER AND HIS CONTACT NUMBER WHO HAVE BROUGHT THE ELECTRONIC ITEM  GRINDER

SELECT CUSTOMER_NAME,CUSTOMER_CONTACT
FROM CUSTOMER,SOLD_TO
WHERE CUSTOMER.C_ID=SOLD_TO.C_ID AND E_NAME='GRINDER'


2)List the  branches ALONG WITH ITS no of TRANSACTIONS where more than 1 transactions occured After 2010

Select s_branch,COUNT(T_ID) AS NO_OF_TRANSACTIONS
From TRANSACTIONS T, Shop S
Where T.S_id=S.S_id and t_date like '201_______'
Group by s_branch
Having count(t_id)>1


3)INCREASE THE PRICE OF ALL ELECTRONICS THAT ARE AVAILABLE AT MANGLORE BY 10%

Select E_ID,MODEL,1.1*price AS New_price
From shop S , Electronics E
Where S.S_ID=E.S_ID AND s_branch='MANGALORE'

4) stored procedure

create procedure electronics_details1 @shop_id varchar(20)
as
select * from Electronics
where S_ID=@shop_id
go 

exec electronics_details1 @shop_id='S001'

5) TRIGGER



create trigger available
on electronics 
after insert
as

declare @e_id varchar(20)
declare @available char(3)
select @e_id=i.e_id from inserted i
update electronics
set available='Y'
where e_id=@e_id

go

